# Websocket-сервер волчьей мудрости


Приложение отправляет пользователям цитаты волчьей мудрости. В него встроен UI клиент (статика) для демонстрации 
его работоспособности и тестирования. В рамках ws протокола между клиентом и сервером описана следующая договоренность:

### События серверной стороны
 INITIAL

Событие позволяет клиенту и серверу установить соответствие пользовательского соединения с присвоенным ему id (uuid)
```json
{
  "type": "initial",
  "payload": {
    "id": "{client_id}"
  }
}
```

SUBSCRIBE_CONFIRMATION

Событие являет собой подтверждение клиенту, что подписка на рассылку сообщений успешно обработана сервером
```json
{
  "type": "subscribe_confirmation",
  "payload": {
    "status": "ok"
  }
}
```

WISDOM_DISTRIBUTION

Событие позволяет клиенту обработать и отобразить направленную сервером волчью цитату
```json
{
  "type": "wisdom_distribution",
  "payload": {
    "message": "{message}"
  }
}
```
### События клиентской стороны
CONNECT

Событие является подтверждением того, что клиент обработал присвоенный ему id, после чего сервер помещает 
это соединение в пул готовых принимать сообщения
```json
{
  "type": "connect",
  "payload": {
    "id": "{connection_id}"
  }
}
```

DISCONNECT

Событие уведомляет сервер о том, что пользователь завершил сеанс

```json
{
  "type": "disconnect",
  "payload": {
    "id": "{connection_id}"
  }
}
```
SUBSCRIBE

Событие уведомляет сервер о том, что пользователь подписался на рассылку сообщений  и готов принимать волчьи цитаты

```json
{
  "type": "subscribe",
  "payload": {
    "id": "{connection_id}"
  }
}
```

UNSUBSCRIBE

Событие уведомляет сервер о том, что пользователь отписался от рассылки сообщений и ему больше не нужно присылать волчьи цитаты

```json
{
  "type": "unsubscribe",
  "payload": {
    "id": "{connection_id}"
  }
}
```

PING

Событие, которое каждые 5 секунд генерируется релевантной сессией пользователя. Оно позволяет контролировать серверу пул
актуальных соединений и избавляться от мертвых пользователей быстрее тайминга, 
предусмотренного стандартной процедурой проверки соединения TCP протоколом
```json
{
  "type": "ping",
  "payload": {
    "id": "{connection_id}"
  }
}
```
## Как запустить локально?
### ! python >= 3.10 !
### Виртуальное окружение
1. Настроить окружение
```
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```
2. Запустить `python main.py`
3. Открыть браузер на http://localhost:8000

### Docker
1. Запустить `docker build . -t "wolf-wisdom-app"` 
2. Запустить `docker run -p 8000:8000 --name wolf-wisdom-ws-service wolf-wisdom-app`
3. Открыть браузер на http://localhost:8000
## Как тестировать?
Можно открыть несколько удобных вам браузеров. В каждом из которых асинхронно пройтись по сценарию подписки/отписки.
Вы убедитесь в том, что сообщения отправляются клиентам в режиме реального времени, с помощью централизованного механизма
рассылки. После отписки клиент не получает цитаты. Смотря в логи используемого вами окружения вы можете убедиться в том,
что процесс отправки сообщений стабильно работает на заднем фоне и не зависит от текущего пула актуальных/подписанных пользователей.